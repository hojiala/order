<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AI 早餐店 - LIFF 點餐版</title>
    <script src="https://static.line-scdn.net/liff/edge/2/sdk.js"></script>
    <script src="https://cdn.tailwindcss.com"></script>
</head>
<body class="bg-gray-50">

    <div class="max-w-md mx-auto min-h-screen bg-white shadow-xl">
        <div id="user-info" class="bg-yellow-500 p-4 text-white flex items-center gap-4">
            <div id="user-avatar" class="w-12 h-12 bg-yellow-600 rounded-full overflow-hidden hidden">
                <img id="avatar-img" src="" alt="avatar">
            </div>
            <div>
                <p class="text-xs opacity-80">歡迎光臨</p>
                <p id="welcome-msg" class="font-bold">載入中...</p>
            </div>
        </div>

        <main class="p-4">
            <h2 class="text-lg font-bold mb-4">點餐內容</h2>
            <div id="menu-list" class="space-y-3"></div>
        </main>

        <div id="order-form" class="p-4 border-t space-y-3">
            <div id="name-field">
                <label class="text-sm font-medium">訂購人姓名</label>
                <input type="text" id="cust-name" class="w-full p-2 border rounded" placeholder="請輸入姓名">
            </div>
            
            <button onclick="submitOrder()" class="w-full bg-green-600 text-white py-3 rounded-lg font-bold">送出訂單</button>
        </div>
    </div>

    <script>
        const LIFF_ID = "YOUR_LIFF_ID_HERE"; // 貼上你的 LIFF ID

        async function initLIFF() {
            try {
                await liff.init({ liffId: LIFF_ID });
                if (liff.isLoggedIn()) {
                    const profile = await liff.getProfile();
                    document.getElementById('welcome-msg').innerText = profile.displayName;
                    document.getElementById('cust-name').value = profile.displayName;
                    document.getElementById('avatar-img').src = profile.pictureUrl;
                    document.getElementById('user-avatar').classList.remove('hidden');
                    // 在 LINE 裡面時，可以隱藏姓名輸入框避免重複輸入
                    // document.getElementById('name-field').classList.add('hidden');
                } else {
                    // 非 LINE 環境或未登入
                    document.getElementById('welcome-msg').innerText = "訪客 (建議用 LINE 開啟)";
                    // 如果你想強迫登入 LINE： liff.login();
                }
            } catch (err) {
                console.error("LIFF 初始化失敗", err);
                document.getElementById('welcome-msg').innerText = "普通瀏覽器模式";
            }
        }

        // 啟動初始化
        initLIFF();

        // 提交訂單時，順便傳送 LINE 的 userId 給 Node-RED
        async function submitOrder() {
            let userId = "guest";
            if (liff.isLoggedIn()) {
                const context = liff.getContext();
                userId = context.userId;
            }

            const payload = {
                order_source: "liff_web",
                line_user_id: userId,
                customer_info: {
                    name: document.getElementById('cust-name').value,
                    // 其他資訊...
                },
                // ... 購物車資料
            };

            // 呼叫你的 Node-RED API
            console.log("發送訂單:", payload);
            alert("下單成功！");
        }
    </script>
</body>
</html>